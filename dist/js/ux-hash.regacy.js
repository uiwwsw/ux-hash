"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var UxHash =
/*#__PURE__*/
function () {
  function UxHash(querySelector, themes) {
    _classCallCheck(this, UxHash);

    this.id = Math.random().toString(36).substr(2, 9);
    this.querySelector = querySelector;
    this.keys = themes.map(function (theme) {
      return theme.key;
    });
    this.colors = themes.map(function (theme) {
      return theme.color;
    });
    this.bgs = themes.map(function (theme) {
      return theme.bg;
    });
    this.wrapperElement = document.querySelector(this.querySelector);
    this.textareaElement = document.createElement('textarea');
    this.displayElement = document.createElement('div');
    this.makeStyle();
    this.wrapperElement.appendChild(this.textareaElement);
    this.wrapperElement.appendChild(this.displayElement);
    this.displayElement.style.right = this.textareaElement.scrollWidth - this.textareaElement.clientWidth + 'px';
    this.textareaElement.onkeyup = this.keyEvent.bind(this);
    this.textareaElement.onscroll = this.scrollEvent.bind(this);
  }

  _createClass(UxHash, [{
    key: "makeStyle",
    value: function makeStyle() {
      var commonStyle = 'overflow: auto;overflow-x: hidden;display: block !important;height: 100%;margin: 0;padding: 1em;box-sizing: border-box;border: 0;line-height: inherit;word-spacing: inherit;color: inherit;font: inherit;resize: none;outline: none;word-break: initial;white-space: pre-wrap;';
      this.wrapperElement.style.position = 'relative';
      this.wrapperElement.style.fontSize = '12px';
      this.textareaElement.setAttribute('style', commonStyle + 'width: 100%;');
      this.displayElement.setAttribute('style', commonStyle + 'z-index:2;position: absolute;top: 0;right: 0;left: 0;overflow: hidden;color: transparent;pointer-events: none;');
    }
  }, {
    key: "scrollEvent",
    value: function scrollEvent() {
      this.displayElement.scrollTop = this.textareaElement.scrollTop;
      this.textareaElement.scrollTop = this.displayElement.scrollTop;
    }
  }, {
    key: "mask",
    value: function mask() {
      var _this = this;

      var res = '';
      this.textareaElement.value.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").split('\n').forEach(function (line, i) {
        res += i === 0 ? '' : '\n';
        line.split(' ').forEach(function (word, j) {
          res += j === 0 ? '' : ' ';

          var index = _this.keys.indexOf(word[0]);

          if (index === -1) {
            res += word;
          } else {
            res += "<span style=\"margin: -.1em;padding: 0 .1em;border-radius: 1em;color:".concat(_this.colors[index], ";background:").concat(_this.bgs[index], ";\">").concat(word, "</span>");
          }
        });
      });
      return res + '\n\n';
    }
  }, {
    key: "keyEvent",
    value: function keyEvent() {
      this.displayElement.innerHTML = this.mask();
      this.scrollEvent();
    }
  }], [{
    key: "keyEvent",
    value: function keyEvent(querySelector, themes) {
      var wrapperElement = document.querySelector(querySelector);
      var textareaElement = wrapperElement.querySelector('textarea');
      var displayElement = wrapperElement.querySelector('div');
      var value = wrapperElement.querySelector('textarea').value;
      var keys = themes.map(function (theme) {
        return theme.key;
      });
      var colors = themes.map(function (theme) {
        return theme.color;
      });
      var bgs = themes.map(function (theme) {
        return theme.bg;
      });
      var res = '';
      value.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").split('\n').forEach(function (line, i) {
        res += i === 0 ? '' : '\n';
        line.split(' ').forEach(function (word, j) {
          res += j === 0 ? '' : ' ';
          var index = keys.indexOf(word[0]);

          if (index === -1) {
            res += word;
          } else {
            res += "<span style=\"margin: -.1em;padding: 0 .1em;border-radius: 1em;color:".concat(colors[index], ";background:").concat(bgs[index], ";\">").concat(word, "</span>");
          }
        });
      });
      displayElement.scrollTop = textareaElement.scrollTop;
      textareaElement.scrollTop = displayElement.scrollTop;
      displayElement.innerHTML = res + '\n\n';
    }
  }]);

  return UxHash;
}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIiwiaW5kZXgudHMiXSwibmFtZXMiOlsiVXhIYXNoIiwicXVlcnlTZWxlY3RvciIsInRoZW1lcyIsImlkIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyIiwia2V5cyIsIm1hcCIsInRoZW1lIiwia2V5IiwiY29sb3JzIiwiY29sb3IiLCJiZ3MiLCJiZyIsIndyYXBwZXJFbGVtZW50IiwiZG9jdW1lbnQiLCJ0ZXh0YXJlYUVsZW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiZGlzcGxheUVsZW1lbnQiLCJtYWtlU3R5bGUiLCJhcHBlbmRDaGlsZCIsInN0eWxlIiwicmlnaHQiLCJzY3JvbGxXaWR0aCIsImNsaWVudFdpZHRoIiwib25rZXl1cCIsImtleUV2ZW50IiwiYmluZCIsIm9uc2Nyb2xsIiwic2Nyb2xsRXZlbnQiLCJjb21tb25TdHlsZSIsInBvc2l0aW9uIiwiZm9udFNpemUiLCJzZXRBdHRyaWJ1dGUiLCJzY3JvbGxUb3AiLCJyZXMiLCJ2YWx1ZSIsInJlcGxhY2UiLCJzcGxpdCIsImZvckVhY2giLCJsaW5lIiwiaSIsIndvcmQiLCJqIiwiaW5kZXgiLCJpbmRleE9mIiwiaW5uZXJIVE1MIiwibWFzayJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7O0lDQU1BLE07OztBQVNGLGtCQUFZQyxhQUFaLEVBQW1DQyxNQUFuQyxFQUFrRDtBQUFBOztBQUM5QyxTQUFLQyxFQUFMLEdBQVVDLElBQUksQ0FBQ0MsTUFBTCxHQUFjQyxRQUFkLENBQXVCLEVBQXZCLEVBQTJCQyxNQUEzQixDQUFrQyxDQUFsQyxFQUFxQyxDQUFyQyxDQUFWO0FBQ0EsU0FBS04sYUFBTCxHQUFxQkEsYUFBckI7QUFDQSxTQUFLTyxJQUFMLEdBQVlOLE1BQU0sQ0FBQ08sR0FBUCxDQUFXLFVBQUNDLEtBQUQ7QUFBQSxhQUFrQkEsS0FBSyxDQUFDQyxHQUF4QjtBQUFBLEtBQVgsQ0FBWjtBQUNBLFNBQUtDLE1BQUwsR0FBY1YsTUFBTSxDQUFDTyxHQUFQLENB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bURBLE9BQW5ELENBQTJELElBQTNELEVBQWlFLE1BQWpFLEVBQXlFQyxLQUF6RSxDQUErRSxJQUEvRSxFQUFxRkMsT0FBckYsQ0FBNkYsVUFBQ0MsSUFBRCxFQUFlQyxDQUFmLEVBQTRCO0FBQ3JITixRQUFBQSxHQUFHLElBQUtNLENBQUMsS0FBSyxDQUFOLEdBQVUsRUFBVixHQUFlLElBQXZCO0FBQ0FELFFBQUFBLElBQUksQ0FBQ0YsS0FBTCxDQUFXLEdBQVgsRUFBZ0JDLE9BQWhCLENBQXdCLFVBQUNHLElBQUQsRUFBZUMsQ0FBZixFQUE0QjtBQUNoRFIsVUFBQUEsR0FBRyxJQUFLUSxDQUFDLEtBQUssQ0FBTixHQUFVLEVBQVYsR0FBZSxHQUF2QjtBQUNBLGNBQU1DLEtBQUssR0FBR3RDLElBQUksQ0FBQ3VDLE9BQUwsQ0FBYUgsSUFBSSxDQUFDLENBQUQsQ0FBakIsQ0FBZDs7QUFDQSxjQUFJRSxLQUFLLEtBQUssQ0FBQyxDQUFmLEVBQWtCO0FBQ2RULFlBQUFBLEdBQUcsSUFBSU8sSUFBUDtBQUNILFdBRkQsTUFFTztBQUNIUCxZQUFBQSxHQUFHLG1GQUEyRXpCLE1BQU0sQ0FBQ2tDLEtBQUQsQ0FBakYseUJBQXVHaEMsR0FBRyxDQUFDZ0MsS0FBRCxDQUExRyxpQkFBdUhGLElBQXZILFlBQUg7QUFDSDtBQUNKLFNBUkQ7QUFTSCxPQVhEO0FBWUF4QixNQUFBQSxjQUFjLENBQUNnQixTQUFmLEdBQTJCbEIsZUFBZSxDQUFDa0IsU0FBM0M7QUFDQWxCLE1BQUFBLGVBQWUsQ0FBQ2tCLFNBQWhCLEdBQTRCaEIsY0FBYyxDQUFDZ0IsU0FBM0M7QUFDQWhCLE1BQUFBLGNBQWMsQ0FBQzRCLFNBQWYsR0FBMkJYLEdBQUcsR0FBRyxNQUFqQztBQUNIIiwiZmlsZSI6ImpzL3V4LWhhc2gucmVnYWN5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5jbGFzcyBVeEhhc2gge1xuICAgIGNvbnN0cnVjdG9yKHF1ZXJ5U2VsZWN0b3IsIHRoZW1lcykge1xuICAgICAgICB0aGlzLmlkID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpO1xuICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3IgPSBxdWVyeVNlbGVjdG9yO1xuICAgICAgICB0aGlzLmtleXMgPSB0aGVtZXMubWFwKCh0aGVtZSkgPT4gdGhlbWUua2V5KTtcbiAgICAgICAgdGhpcy5jb2xvcnMgPSB0aGVtZXMubWFwKCh0aGVtZSkgPT4gdGhlbWUuY29sb3IpO1xuICAgICAgICB0aGlzLmJncyA9IHRoZW1lcy5tYXAoKHRoZW1lKSA9PiB0aGVtZS5iZyk7XG4gICAgICAgIHRoaXMud3JhcHBlckVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMucXVlcnlTZWxlY3Rvcik7XG4gICAgICAgIHRoaXMudGV4dGFyZWFFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKTtcbiAgICAgICAgdGhpcy5kaXNwbGF5RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLm1ha2VTdHlsZSgpO1xuICAgICAgICB0aGlzLndyYXBwZXJFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMudGV4dGFyZWFFbGVtZW50KTtcbiAgICAgICAgdGhpcy53cmFwcGVyRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmRpc3BsYXlFbGVtZW50KTtcbiAgICAgICAgdGhpcy5kaXNwbGF5RWxlbWVudC5zdHlsZS5yaWdodCA9IHRoaXMudGV4dGFyZWFFbGVtZW50LnNjcm9sbFdpZHRoIC0gdGhpcy50ZXh0YXJlYUVsZW1lbnQuY2xpZW50V2lkdGggKyAncHgnO1xuICAgICAgICB0aGlzLnRleHRhcmVhRWxlbWVudC5vbmtleXVwID0gdGhpcy5rZXlFdmVudC5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLnRleHRhcmVhRWxlbWVudC5vbnNjcm9sbCA9IHRoaXMuc2Nyb2xsRXZlbnQuYmluZCh0aGlzKTtcbiAgICB9XG4gICAgbWFrZVN0eWxlKCkge1xuICAgICAgICBjb25zdCBjb21tb25TdHlsZSA9ICdvdmVyZmxvdzogYXV0bztvdmVyZmxvdy14OiBoaWRkZW47ZGlzcGxheTogYmxvY2sgIWltcG9ydGFudDtoZWlnaHQ6IDEwMCU7bWFyZ2luOiAwO3BhZGRpbmc6IDFlbTtib3gtc2l6aW5nOiBib3JkZXItYm94O2JvcmRlcjogMDtsaW5lLWhlaWdodDogaW5oZXJpdDt3b3JkLXNwYWNpbmc6IGluaGVyaXQ7Y29sb3I6IGluaGVyaXQ7Zm9udDogaW5oZXJpdDtyZXNpemU6IG5vbmU7b3V0bGluZTogbm9uZTt3b3JkLWJyZWFrOiBpbml0aWFsO3doaXRlLXNwYWNlOiBwcmUtd3JhcDsnO1xuICAgICAgICB0aGlzLndyYXBwZXJFbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJztcbiAgICAgICAgdGhpcy53cmFwcGVyRWxlbWVudC5zdHlsZS5mb250U2l6ZSA9ICcxMnB4JztcbiAgICAgICAgdGhpcy50ZXh0YXJlYUVsZW1lbnQuc2V0QXR0cmlidXRlKCdzdHlsZScsIGNvbW1vblN0eWxlICsgJ3dpZHRoOiAxMDAlOycpO1xuICAgICAgICB0aGlzLmRpc3BsYXlFbGVtZW50LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBjb21tb25TdHlsZSArICd6LWluZGV4OjI7cG9zaXRpb246IGFic29sdXRlO3RvcDogMDtyaWdodDogMDtsZWZ0OiAwO292ZXJmbG93OiBoaWRkZW47Y29sb3I6IHRyYW5zcGFyZW50O3BvaW50ZXItZXZlbnRzOiBub25lOycpO1xuICAgIH1cbiAgICBzY3JvbGxFdmVudCgpIHtcbiAgICAgICAgdGhpcy5kaXNwbGF5RWxlbWVudC5zY3JvbGxUb3AgPSB0aGlzLnRleHRhcmVhRWxlbWVudC5zY3JvbGxUb3A7XG4gICAgICAgIHRoaXMudGV4dGFyZWFFbGVtZW50LnNjcm9sbFRvcCA9IHRoaXMuZGlzcGxheUVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgIH1cbiAgICBzdGF0aWMga2V5RXZlbnQocXVlcnlTZWxlY3RvciwgdGhlbWVzKSB7XG4gICAgICAgIGNvbnN0IHdyYXBwZXJFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihxdWVyeVNlbGVjdG9yKTtcbiAgICAgICAgY29uc3QgdGV4dGFyZWFFbGVtZW50ID0gd3JhcHBlckVsZW1lbnQucXVlcnlTZWxlY3RvcigndGV4dGFyZWEnKTtcbiAgICAgICAgY29uc3QgZGlzcGxheUVsZW1lbnQgPSB3cmFwcGVyRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdkaXYnKTtcbiAgICAgICAgY29uc3QgdmFsdWUgPSB3cmFwcGVyRWxlbWVudC5xdWVyeVNlbGVjdG9yKCd0ZXh0YXJlYScpLnZhbHVlO1xuICAgICAgICBjb25zdCBrZXlzID0gdGhlbWVzLm1hcCgodGhlbWUpID0+IHRoZW1lLmtleSk7XG4gICAgICAgIGNvbnN0IGNvbG9ycyA9IHRoZW1lcy5tYXAoKHRoZW1lKSA9PiB0aGVtZS5jb2xvcik7XG4gICAgICAgIGNvbnN0IGJncyA9IHRoZW1lcy5tYXAoKHRoZW1lKSA9PiB0aGVtZS5iZyk7XG4gICAgICAgIGxldCByZXMgPSAnJztcbiAgICAgICAgdmFsdWUucmVwbGFjZSgvJi9nLCBcIiZhbXA7XCIpLnJlcGxhY2UoLzwvZywgXCImbHQ7XCIpLnJlcGxhY2UoLz4vZywgXCImZ3Q7XCIpLnNwbGl0KCdcXG4nKS5mb3JFYWNoKChsaW5lLCBpKSA9PiB7XG4gICAgICAgICAgICByZXMgKz0gKGkgPT09IDAgPyAnJyA6ICdcXG4nKTtcbiAgICAgICAgICAgIGxpbmUuc3BsaXQoJyAnKS5mb3JFYWNoKCh3b3JkLCBqKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVzICs9IChqID09PSAwID8gJycgOiAnICcpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0ga2V5cy5pbmRleE9mKHdvcmRbMF0pO1xuICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzICs9IHdvcmQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXMgKz0gYDxzcGFuIHN0eWxlPVwibWFyZ2luOiAtLjFlbTtwYWRkaW5nOiAwIC4xZW07Ym9yZGVyLXJhZGl1czogMWVtO2NvbG9yOiR7Y29sb3JzW2luZGV4XX07YmFja2dyb3VuZDoke2Jnc1tpbmRleF19O1wiPiR7d29yZH08L3NwYW4+YDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGRpc3BsYXlFbGVtZW50LnNjcm9sbFRvcCA9IHRleHRhcmVhRWxlbWVudC5zY3JvbGxUb3A7XG4gICAgICAgIHRleHRhcmVhRWxlbWVudC5zY3JvbGxUb3AgPSBkaXNwbGF5RWxlbWVudC5zY3JvbGxUb3A7XG4gICAgICAgIGRpc3BsYXlFbGVtZW50LmlubmVySFRNTCA9IHJlcyArICdcXG5cXG4nO1xuICAgIH1cbiAgICBtYXNrKCkge1xuICAgICAgICBsZXQgcmVzID0gJyc7XG4gICAgICAgIHRoaXMudGV4dGFyZWFFbGVtZW50LnZhbHVlLnJlcGxhY2UoLyYvZywgXCImYW1wO1wiKS5yZXBsYWNlKC88L2csIFwiJmx0O1wiKS5yZXBsYWNlKC8+L2csIFwiJmd0O1wiKS5zcGxpdCgnXFxuJykuZm9yRWFjaCgobGluZSwgaSkgPT4ge1xuICAgICAgICAgICAgcmVzICs9IChpID09PSAwID8gJycgOiAnXFxuJyk7XG4gICAgICAgICAgICBsaW5lLnNwbGl0KCcgJykuZm9yRWFjaCgod29yZCwgaikgPT4ge1xuICAgICAgICAgICAgICAgIHJlcyArPSAoaiA9PT0gMCA/ICcnIDogJyAnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMua2V5cy5pbmRleE9mKHdvcmRbMF0pO1xuICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzICs9IHdvcmQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXMgKz0gYDxzcGFuIHN0eWxlPVwibWFyZ2luOiAtLjFlbTtwYWRkaW5nOiAwIC4xZW07Ym9yZGVyLXJhZGl1czogMWVtO2NvbG9yOiR7dGhpcy5jb2xvcnNbaW5kZXhdfTtiYWNrZ3JvdW5kOiR7dGhpcy5iZ3NbaW5kZXhdfTtcIj4ke3dvcmR9PC9zcGFuPmA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzICsgJ1xcblxcbic7XG4gICAgfVxuICAgIGtleUV2ZW50KCkge1xuICAgICAgICB0aGlzLmRpc3BsYXlFbGVtZW50LmlubmVySFRNTCA9IHRoaXMubWFzaygpO1xuICAgICAgICB0aGlzLnNjcm9sbEV2ZW50KCk7XG4gICAgfVxufVxuIiwiY2xhc3MgVXhIYXNoIHtcbiAgICBwcml2YXRlIGlkOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBxdWVyeVNlbGVjdG9yOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSB3cmFwcGVyRWxlbWVudDogSFRNTERpdkVsZW1lbnQ7XG4gICAgcHJpdmF0ZSB0ZXh0YXJlYUVsZW1lbnQ6IEhUTUxUZXh0QXJlYUVsZW1lbnQ7XG4gICAgcHJpdmF0ZSBkaXNwbGF5RWxlbWVudDogSFRNTERpdkVsZW1lbnQ7XG4gICAgcHJpdmF0ZSBrZXlzOiBzdHJpbmdbXTtcbiAgICBwcml2YXRlIGNvbG9yczogc3RyaW5nW107XG4gICAgcHJpdmF0ZSBiZ3M6IHN0cmluZ1tdO1xuICAgIGNvbnN0cnVjdG9yKHF1ZXJ5U2VsZWN0b3I6IHN0cmluZywgdGhlbWVzOiBUaGVtZVtdKSB7XG4gICAgICAgIHRoaXMuaWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSk7XG4gICAgICAgIHRoaXMucXVlcnlTZWxlY3RvciA9IHF1ZXJ5U2VsZWN0b3I7XG4gICAgICAgIHRoaXMua2V5cyA9IHRoZW1lcy5tYXAoKHRoZW1lOiBUaGVtZSkgPT4gdGhlbWUua2V5KTtcbiAgICAgICAgdGhpcy5jb2xvcnMgPSB0aGVtZXMubWFwKCh0aGVtZTogVGhlbWUpID0+IHRoZW1lLmNvbG9yKTtcbiAgICAgICAgdGhpcy5iZ3MgPSB0aGVtZXMubWFwKCh0aGVtZTogVGhlbWUpID0+IHRoZW1lLmJnKTtcbiAgICAgICAgdGhpcy53cmFwcGVyRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5xdWVyeVNlbGVjdG9yKSBhcyBIVE1MRGl2RWxlbWVudDtcbiAgICAgICAgdGhpcy50ZXh0YXJlYUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpO1xuICAgICAgICB0aGlzLmRpc3BsYXlFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMubWFrZVN0eWxlKCk7XG4gICAgICAgIHRoaXMud3JhcHBlckVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy50ZXh0YXJlYUVsZW1lbnQpO1xuICAgICAgICB0aGlzLndyYXBwZXJFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuZGlzcGxheUVsZW1lbnQpO1xuICAgICAgICB0aGlzLmRpc3BsYXlFbGVtZW50LnN0eWxlLnJpZ2h0ID0gdGhpcy50ZXh0YXJlYUVsZW1lbnQuc2Nyb2xsV2lkdGggLSB0aGlzLnRleHRhcmVhRWxlbWVudC5jbGllbnRXaWR0aCArICdweCc7XG4gICAgICAgIHRoaXMudGV4dGFyZWFFbGVtZW50Lm9ua2V5dXAgPSB0aGlzLmtleUV2ZW50LmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMudGV4dGFyZWFFbGVtZW50Lm9uc2Nyb2xsID0gdGhpcy5zY3JvbGxFdmVudC5iaW5kKHRoaXMpO1xuICAgIH1cblxuICAgIG1ha2VTdHlsZSgpIHtcbiAgICAgICAgY29uc3QgY29tbW9uU3R5bGUgPSAnb3ZlcmZsb3c6IGF1dG87b3ZlcmZsb3cteDogaGlkZGVuO2Rpc3BsYXk6IGJsb2NrICFpbXBvcnRhbnQ7aGVpZ2h0OiAxMDAlO21hcmdpbjogMDtwYWRkaW5nOiAxZW07Ym94LXNpemluZzogYm9yZGVyLWJveDtib3JkZXI6IDA7bGluZS1oZWlnaHQ6IGluaGVyaXQ7d29yZC1zcGFjaW5nOiBpbmhlcml0O2NvbG9yOiBpbmhlcml0O2ZvbnQ6IGluaGVyaXQ7cmVzaXplOiBub25lO291dGxpbmU6IG5vbmU7d29yZC1icmVhazogaW5pdGlhbDt3aGl0ZS1zcGFjZTogcHJlLXdyYXA7J1xuICAgICAgICB0aGlzLndyYXBwZXJFbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJztcbiAgICAgICAgdGhpcy53cmFwcGVyRWxlbWVudC5zdHlsZS5mb250U2l6ZSA9ICcxMnB4JztcbiAgICAgICAgdGhpcy50ZXh0YXJlYUVsZW1lbnQuc2V0QXR0cmlidXRlKCdzdHlsZScsIGNvbW1vblN0eWxlICsgJ3dpZHRoOiAxMDAlOycpO1xuICAgICAgICB0aGlzLmRpc3BsYXlFbGVtZW50LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBjb21tb25TdHlsZSArICd6LWluZGV4OjI7cG9zaXRpb246IGFic29sdXRlO3RvcDogMDtyaWdodDogMDtsZWZ0OiAwO292ZXJmbG93OiBoaWRkZW47Y29sb3I6IHRyYW5zcGFyZW50O3BvaW50ZXItZXZlbnRzOiBub25lOycgKTtcbiAgICB9XG5cbiAgICBzY3JvbGxFdmVudCgpIHtcbiAgICAgICAgdGhpcy5kaXNwbGF5RWxlbWVudC5zY3JvbGxUb3AgPSB0aGlzLnRleHRhcmVhRWxlbWVudC5zY3JvbGxUb3A7XG4gICAgICAgIHRoaXMudGV4dGFyZWFFbGVtZW50LnNjcm9sbFRvcCA9IHRoaXMuZGlzcGxheUVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgIH1cblxuICAgIHN0YXRpYyBrZXlFdmVudChxdWVyeVNlbGVjdG9yOiBzdHJpbmcsIHRoZW1lczogVGhlbWVbXSkge1xuICAgICAgICBjb25zdCB3cmFwcGVyRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocXVlcnlTZWxlY3RvcikgYXMgSFRNTERpdkVsZW1lbnQ7XG4gICAgICAgIGNvbnN0IHRleHRhcmVhRWxlbWVudCA9IHdyYXBwZXJFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3RleHRhcmVhJykgYXMgSFRNTFRleHRBcmVhRWxlbWVudDtcbiAgICAgICAgY29uc3QgZGlzcGxheUVsZW1lbnQgPSB3cmFwcGVyRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdkaXYnKSBhcyBIVE1MRGl2RWxlbWVudDtcbiAgICAgICAgY29uc3QgdmFsdWUgPSB3cmFwcGVyRWxlbWVudC5xdWVyeVNlbGVjdG9yKCd0ZXh0YXJlYScpIS52YWx1ZTtcbiAgICAgICAgY29uc3Qga2V5cyA9IHRoZW1lcy5tYXAoKHRoZW1lOiBUaGVtZSkgPT4gdGhlbWUua2V5KTtcbiAgICAgICAgY29uc3QgY29sb3JzID0gdGhlbWVzLm1hcCgodGhlbWU6IFRoZW1lKSA9PiB0aGVtZS5jb2xvcik7XG4gICAgICAgIGNvbnN0IGJncyA9IHRoZW1lcy5tYXAoKHRoZW1lOiBUaGVtZSkgPT4gdGhlbWUuYmcpO1xuICAgICAgICBsZXQgcmVzID0gJyc7XG4gICAgICAgIHZhbHVlLnJlcGxhY2UoLyYvZywgXCImYW1wO1wiKS5yZXBsYWNlKC88L2csIFwiJmx0O1wiKS5yZXBsYWNlKC8+L2csIFwiJmd0O1wiKS5zcGxpdCgnXFxuJykuZm9yRWFjaCgobGluZTogc3RyaW5nLCBpOiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgIHJlcyArPSAoaSA9PT0gMCA/ICcnIDogJ1xcbicpO1xuICAgICAgICAgICAgbGluZS5zcGxpdCgnICcpLmZvckVhY2goKHdvcmQ6IHN0cmluZywgajogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVzICs9IChqID09PSAwID8gJycgOiAnICcpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0ga2V5cy5pbmRleE9mKHdvcmRbMF0pO1xuICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzICs9IHdvcmQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHsgXG4gICAgICAgICAgICAgICAgICAgIHJlcyArPSBgPHNwYW4gc3R5bGU9XCJtYXJnaW46IC0uMWVtO3BhZGRpbmc6IDAgLjFlbTtib3JkZXItcmFkaXVzOiAxZW07Y29sb3I6JHtjb2xvcnNbaW5kZXhdfTtiYWNrZ3JvdW5kOiR7YmdzW2luZGV4XX07XCI+JHt3b3JkfTwvc3Bhbj5gXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBkaXNwbGF5RWxlbWVudC5zY3JvbGxUb3AgPSB0ZXh0YXJlYUVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgICAgICB0ZXh0YXJlYUVsZW1lbnQuc2Nyb2xsVG9wID0gZGlzcGxheUVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgICAgICBkaXNwbGF5RWxlbWVudC5pbm5lckhUTUwgPSByZXMgKyAnXFxuXFxuJztcbiAgICB9XG5cbiAgICBtYXNrKCkge1xuICAgICAgICBsZXQgcmVzID0gJyc7XG4gICAgICAgIHRoaXMudGV4dGFyZWFFbGVtZW50LnZhbHVlLnJlcGxhY2UoLyYvZywgXCImYW1wO1wiKS5yZXBsYWNlKC88L2csIFwiJmx0O1wiKS5yZXBsYWNlKC8+L2csIFwiJmd0O1wiKS5zcGxpdCgnXFxuJykuZm9yRWFjaCgobGluZTogc3RyaW5nLCBpOiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgIHJlcyArPSAoaSA9PT0gMCA/ICcnIDogJ1xcbicpO1xuICAgICAgICAgICAgbGluZS5zcGxpdCgnICcpLmZvckVhY2goKHdvcmQ6IHN0cmluZywgajogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVzICs9IChqID09PSAwID8gJycgOiAnICcpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5rZXlzLmluZGV4T2Yod29yZFswXSk7XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICByZXMgKz0gd29yZDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXMgKz0gYDxzcGFuIHN0eWxlPVwibWFyZ2luOiAtLjFlbTtwYWRkaW5nOiAwIC4xZW07Ym9yZGVyLXJhZGl1czogMWVtO2NvbG9yOiR7dGhpcy5jb2xvcnNbaW5kZXhdfTtiYWNrZ3JvdW5kOiR7dGhpcy5iZ3NbaW5kZXhdfTtcIj4ke3dvcmR9PC9zcGFuPmBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXMgKyAnXFxuXFxuJztcbiAgICB9XG5cbiAgICBrZXlFdmVudCgpIHtcbiAgICAgICAgdGhpcy5kaXNwbGF5RWxlbWVudC5pbm5lckhUTUwgPSB0aGlzLm1hc2soKTtcbiAgICAgICAgdGhpcy5zY3JvbGxFdmVudCgpO1xuICAgIH1cbn1cbnR5cGUgVGhlbWUgPSB7XG4gICAgYmc6c3RyaW5nLFxuICAgIGNvbG9yOnN0cmluZyxcbiAgICBrZXk6c3RyaW5nXG59Il19
