"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var UxHash =
/*#__PURE__*/
function () {
  function UxHash(querySelector, themes) {
    _classCallCheck(this, UxHash);

    this.id = Math.random().toString(36).substr(2, 9);
    this.querySelector = querySelector;
    this.keys = themes.map(function (theme) {
      return theme.key;
    });
    this.colors = themes.map(function (theme) {
      return theme.color;
    });
    this.bgs = themes.map(function (theme) {
      return theme.bg;
    });
    this.wrapperElement = document.querySelector(this.querySelector);
    this.textareaElement = document.createElement('textarea');
    this.displayElement = document.createElement('div');
    this.makeStyle();
    this.wrapperElement.appendChild(this.textareaElement);
    this.wrapperElement.appendChild(this.displayElement);
    this.displayElement.style.right = this.textareaElement.scrollWidth - this.textareaElement.clientWidth + 'px';
    this.textareaElement.onkeyup = this.keyEvent.bind(this);
    this.textareaElement.onscroll = this.scrollEvent.bind(this);
  }

  _createClass(UxHash, [{
    key: "makeStyle",
    value: function makeStyle() {
      var commonStyle = 'overflow: auto;overflow-x: hidden;display: block !important;height: 100%;margin: 0;padding: 1em;box-sizing: border-box;border: 0;line-height: inherit;word-spacing: inherit;color: inherit;font: inherit;resize: none;outline: none;word-break: initial;white-space: pre-wrap;';
      this.wrapperElement.style.position = 'relative';
      this.wrapperElement.style.fontSize = '12px';
      this.textareaElement.setAttribute('style', commonStyle + 'width: 100%;');
      this.displayElement.setAttribute('style', commonStyle + 'z-index:2;position: absolute;top: 0;right: 0;left: 0;overflow: hidden;color: transparent;pointer-events: none;');
    }
  }, {
    key: "scrollEvent",
    value: function scrollEvent() {
      this.displayElement.scrollTop = this.textareaElement.scrollTop;
      this.textareaElement.scrollTop = this.displayElement.scrollTop;
    }
  }, {
    key: "mask",
    value: function mask() {
      var _this = this;

      var res = '';
      this.textareaElement.value.split('\n').forEach(function (line, i) {
        res += i === 0 ? '' : '\n';
        line.split(' ').forEach(function (word, j) {
          res += j === 0 ? '' : ' ';

          var index = _this.keys.indexOf(word[0]);

          if (index === -1) {
            res += word;
          } else {
            res += "<span style=\"margin: -.1em;padding: 0 .1em;border-radius: 1em;color:".concat(_this.colors[index], ";background:").concat(_this.bgs[index], ";\">").concat(word, "</span>");
          }
        });
      });
      return res + '\n\n';
    }
  }, {
    key: "keyEvent",
    value: function keyEvent() {
      this.displayElement.innerHTML = this.mask();
      this.scrollEvent();
    }
  }], [{
    key: "keyEvent",
    value: function keyEvent(querySelector, themes) {
      var wrapperElement = document.querySelector(querySelector);
      var textareaElement = wrapperElement.querySelector('textarea');
      var displayElement = wrapperElement.querySelector('div');
      var id = wrapperElement.className;
      var value = wrapperElement.querySelector('textarea').value;
      var keys = themes.map(function (theme) {
        return theme.key;
      });
      var colors = themes.map(function (theme) {
        return theme.color;
      });
      var bgs = themes.map(function (theme) {
        return theme.bg;
      });
      var res = '';
      value.split('\n').forEach(function (line, i) {
        res += i === 0 ? '' : '\n';
        line.split(' ').forEach(function (word, j) {
          res += j === 0 ? '' : ' ';
          var index = keys.indexOf(word[0]);

          if (index === -1) {
            res += word;
          } else {
            res += "<span style=\"margin: -.1em;padding: 0 .1em;border-radius: 1em;color:".concat(colors[index], ";background:").concat(bgs[index], ";\">").concat(word, "</span>");
          }
        });
      });
      displayElement.scrollTop = textareaElement.scrollTop;
      textareaElement.scrollTop = displayElement.scrollTop;
      displayElement.innerHTML = res + '\n\n';
    }
  }]);

  return UxHash;
}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIiwiaW5kZXgudHMiXSwibmFtZXMiOlsiVXhIYXNoIiwicXVlcnlTZWxlY3RvciIsInRoZW1lcyIsImlkIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyIiwia2V5cyIsIm1hcCIsInRoZW1lIiwia2V5IiwiY29sb3JzIiwiY29sb3IiLCJiZ3MiLCJiZyIsIndyYXBwZXJFbGVtZW50IiwiZG9jdW1lbnQiLCJ0ZXh0YXJlYUVsZW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiZGlzcGxheUVsZW1lbnQiLCJtYWtlU3R5bGUiLCJhcHBlbmRDaGlsZCIsInN0eWxlIiwicmlnaHQiLCJzY3JvbGxXaWR0aCIsImNsaWVudFdpZHRoIiwib25rZXl1cCIsImtleUV2ZW50IiwiYmluZCIsIm9uc2Nyb2xsIiwic2Nyb2xsRXZlbnQiLCJjb21tb25TdHlsZSIsInBvc2l0aW9uIiwiZm9udFNpemUiLCJzZXRBdHRyaWJ1dGUiLCJzY3JvbGxUb3AiLCJyZXMiLCJ2YWx1ZSIsInNwbGl0IiwiZm9yRWFjaCIsImxpbmUiLCJpIiwid29yZCIsImoiLCJpbmRleCIsImluZGV4T2YiLCJpbm5lckhUTUwiLCJtYXNrIiwiY2xhc3NOYW1lIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7SUNBTUEsTTs7O0FBU0Ysa0JBQVlDLGFBQVosRUFBbUNDLE1BQW5DLEVBQWtEO0FBQUE7O0FBQzlDLFNBQUtDLEVBQUwsR0FBVUMsSUFBSSxDQUFDQyxNQUFMLEdBQWNDLFFBQWQsQ0FBdUIsRUFBdkIsRUFBMkJDLE1BQTNCLENBQWtDLENBQWxDLEVBQXFDLENBQXJDLENBQVY7QUFDQSxTQUFLTixhQUFMLEdBQXFCQSxhQUFyQjtBQUNBLFNBQUtPLElBQUwsR0FBWU4sTUFBTSxDQUFDTyxHQUFQLENBQVcsVUFBQ0MsS0FBRDtBQUFBLGFBQWtCQSxLQUFLLENBQUNDLEdBQXhCO0FBQUEsS0FBWCxDQUFaO0FBQ0EsU0FBS0MsTUFBTCxHQUFjVixNQUFNLENBQUNPLEdBQVAs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SSxDQUFDRixLQUFMLENBQVcsR0FBWCxFQUFnQkMsT0FBaEIsQ0FBd0IsVUFBQ0csSUFBRCxFQUFlQyxDQUFmLEVBQTRCO0FBQ2hEUCxVQUFBQSxHQUFHLElBQUtPLENBQUMsS0FBSyxDQUFOLEdBQVUsRUFBVixHQUFlLEdBQXZCO0FBQ0EsY0FBTUMsS0FBSyxHQUFHckMsSUFBSSxDQUFDc0MsT0FBTCxDQUFhSCxJQUFJLENBQUMsQ0FBRCxDQUFqQixDQUFkOztBQUNBLGNBQUlFLEtBQUssS0FBSyxDQUFDLENBQWYsRUFBa0I7QUFDZFIsWUFBQUEsR0FBRyxJQUFJTSxJQUFQO0FBQ0gsV0FGRCxNQUVPO0FBQ0hOLFlBQUFBLEdBQUcsbUZBQTJFekIsTUFBTSxDQUFDaUMsS0FBRCxDQUFqRix5QkFBdUcvQixHQUFHLENBQUMrQixLQUFELENBQTFHLGlCQUF1SEYsSUFBdkgsWUFBSDtBQUNIO0FBQ0osU0FSRDtBQVNILE9BWEQ7QUFZQXZCLE1BQUFBLGNBQWMsQ0FBQ2dCLFNBQWYsR0FBMkJsQixlQUFlLENBQUNrQixTQUEzQztBQUNBbEIsTUFBQUEsZUFBZSxDQUFDa0IsU0FBaEIsR0FBNEJoQixjQUFjLENBQUNnQixTQUEzQztBQUNBaEIsTUFBQUEsY0FBYyxDQUFDMkIsU0FBZixHQUEyQlYsR0FBRyxHQUFHLE1BQWpDO0FBQ0giLCJmaWxlIjoianMvdXgtaGFzaC5yZWdhY3kuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbmNsYXNzIFV4SGFzaCB7XG4gICAgY29uc3RydWN0b3IocXVlcnlTZWxlY3RvciwgdGhlbWVzKSB7XG4gICAgICAgIHRoaXMuaWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSk7XG4gICAgICAgIHRoaXMucXVlcnlTZWxlY3RvciA9IHF1ZXJ5U2VsZWN0b3I7XG4gICAgICAgIHRoaXMua2V5cyA9IHRoZW1lcy5tYXAoKHRoZW1lKSA9PiB0aGVtZS5rZXkpO1xuICAgICAgICB0aGlzLmNvbG9ycyA9IHRoZW1lcy5tYXAoKHRoZW1lKSA9PiB0aGVtZS5jb2xvcik7XG4gICAgICAgIHRoaXMuYmdzID0gdGhlbWVzLm1hcCgodGhlbWUpID0+IHRoZW1lLmJnKTtcbiAgICAgICAgdGhpcy53cmFwcGVyRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5xdWVyeVNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy50ZXh0YXJlYUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpO1xuICAgICAgICB0aGlzLmRpc3BsYXlFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMubWFrZVN0eWxlKCk7XG4gICAgICAgIHRoaXMud3JhcHBlckVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy50ZXh0YXJlYUVsZW1lbnQpO1xuICAgICAgICB0aGlzLndyYXBwZXJFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuZGlzcGxheUVsZW1lbnQpO1xuICAgICAgICB0aGlzLmRpc3BsYXlFbGVtZW50LnN0eWxlLnJpZ2h0ID0gdGhpcy50ZXh0YXJlYUVsZW1lbnQuc2Nyb2xsV2lkdGggLSB0aGlzLnRleHRhcmVhRWxlbWVudC5jbGllbnRXaWR0aCArICdweCc7XG4gICAgICAgIHRoaXMudGV4dGFyZWFFbGVtZW50Lm9ua2V5dXAgPSB0aGlzLmtleUV2ZW50LmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMudGV4dGFyZWFFbGVtZW50Lm9uc2Nyb2xsID0gdGhpcy5zY3JvbGxFdmVudC5iaW5kKHRoaXMpO1xuICAgIH1cbiAgICBtYWtlU3R5bGUoKSB7XG4gICAgICAgIGNvbnN0IGNvbW1vblN0eWxlID0gJ292ZXJmbG93OiBhdXRvO292ZXJmbG93LXg6IGhpZGRlbjtkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50O2hlaWdodDogMTAwJTttYXJnaW46IDA7cGFkZGluZzogMWVtO2JveC1zaXppbmc6IGJvcmRlci1ib3g7Ym9yZGVyOiAwO2xpbmUtaGVpZ2h0OiBpbmhlcml0O3dvcmQtc3BhY2luZzogaW5oZXJpdDtjb2xvcjogaW5oZXJpdDtmb250OiBpbmhlcml0O3Jlc2l6ZTogbm9uZTtvdXRsaW5lOiBub25lO3dvcmQtYnJlYWs6IGluaXRpYWw7d2hpdGUtc3BhY2U6IHByZS13cmFwOyc7XG4gICAgICAgIHRoaXMud3JhcHBlckVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnO1xuICAgICAgICB0aGlzLndyYXBwZXJFbGVtZW50LnN0eWxlLmZvbnRTaXplID0gJzEycHgnO1xuICAgICAgICB0aGlzLnRleHRhcmVhRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgY29tbW9uU3R5bGUgKyAnd2lkdGg6IDEwMCU7Jyk7XG4gICAgICAgIHRoaXMuZGlzcGxheUVsZW1lbnQuc2V0QXR0cmlidXRlKCdzdHlsZScsIGNvbW1vblN0eWxlICsgJ3otaW5kZXg6Mjtwb3NpdGlvbjogYWJzb2x1dGU7dG9wOiAwO3JpZ2h0OiAwO2xlZnQ6IDA7b3ZlcmZsb3c6IGhpZGRlbjtjb2xvcjogdHJhbnNwYXJlbnQ7cG9pbnRlci1ldmVudHM6IG5vbmU7Jyk7XG4gICAgfVxuICAgIHNjcm9sbEV2ZW50KCkge1xuICAgICAgICB0aGlzLmRpc3BsYXlFbGVtZW50LnNjcm9sbFRvcCA9IHRoaXMudGV4dGFyZWFFbGVtZW50LnNjcm9sbFRvcDtcbiAgICAgICAgdGhpcy50ZXh0YXJlYUVsZW1lbnQuc2Nyb2xsVG9wID0gdGhpcy5kaXNwbGF5RWxlbWVudC5zY3JvbGxUb3A7XG4gICAgfVxuICAgIHN0YXRpYyBrZXlFdmVudChxdWVyeVNlbGVjdG9yLCB0aGVtZXMpIHtcbiAgICAgICAgY29uc3Qgd3JhcHBlckVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHF1ZXJ5U2VsZWN0b3IpO1xuICAgICAgICBjb25zdCB0ZXh0YXJlYUVsZW1lbnQgPSB3cmFwcGVyRWxlbWVudC5xdWVyeVNlbGVjdG9yKCd0ZXh0YXJlYScpO1xuICAgICAgICBjb25zdCBkaXNwbGF5RWxlbWVudCA9IHdyYXBwZXJFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2RpdicpO1xuICAgICAgICBjb25zdCBpZCA9IHdyYXBwZXJFbGVtZW50LmNsYXNzTmFtZTtcbiAgICAgICAgY29uc3QgdmFsdWUgPSB3cmFwcGVyRWxlbWVudC5xdWVyeVNlbGVjdG9yKCd0ZXh0YXJlYScpLnZhbHVlO1xuICAgICAgICBjb25zdCBrZXlzID0gdGhlbWVzLm1hcCgodGhlbWUpID0+IHRoZW1lLmtleSk7XG4gICAgICAgIGNvbnN0IGNvbG9ycyA9IHRoZW1lcy5tYXAoKHRoZW1lKSA9PiB0aGVtZS5jb2xvcik7XG4gICAgICAgIGNvbnN0IGJncyA9IHRoZW1lcy5tYXAoKHRoZW1lKSA9PiB0aGVtZS5iZyk7XG4gICAgICAgIGxldCByZXMgPSAnJztcbiAgICAgICAgdmFsdWUuc3BsaXQoJ1xcbicpLmZvckVhY2goKGxpbmUsIGkpID0+IHtcbiAgICAgICAgICAgIHJlcyArPSAoaSA9PT0gMCA/ICcnIDogJ1xcbicpO1xuICAgICAgICAgICAgbGluZS5zcGxpdCgnICcpLmZvckVhY2goKHdvcmQsIGopID0+IHtcbiAgICAgICAgICAgICAgICByZXMgKz0gKGogPT09IDAgPyAnJyA6ICcgJyk7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBrZXlzLmluZGV4T2Yod29yZFswXSk7XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICByZXMgKz0gd29yZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcyArPSBgPHNwYW4gc3R5bGU9XCJtYXJnaW46IC0uMWVtO3BhZGRpbmc6IDAgLjFlbTtib3JkZXItcmFkaXVzOiAxZW07Y29sb3I6JHtjb2xvcnNbaW5kZXhdfTtiYWNrZ3JvdW5kOiR7YmdzW2luZGV4XX07XCI+JHt3b3JkfTwvc3Bhbj5gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgZGlzcGxheUVsZW1lbnQuc2Nyb2xsVG9wID0gdGV4dGFyZWFFbGVtZW50LnNjcm9sbFRvcDtcbiAgICAgICAgdGV4dGFyZWFFbGVtZW50LnNjcm9sbFRvcCA9IGRpc3BsYXlFbGVtZW50LnNjcm9sbFRvcDtcbiAgICAgICAgZGlzcGxheUVsZW1lbnQuaW5uZXJIVE1MID0gcmVzICsgJ1xcblxcbic7XG4gICAgfVxuICAgIG1hc2soKSB7XG4gICAgICAgIGxldCByZXMgPSAnJztcbiAgICAgICAgdGhpcy50ZXh0YXJlYUVsZW1lbnQudmFsdWUuc3BsaXQoJ1xcbicpLmZvckVhY2goKGxpbmUsIGkpID0+IHtcbiAgICAgICAgICAgIHJlcyArPSAoaSA9PT0gMCA/ICcnIDogJ1xcbicpO1xuICAgICAgICAgICAgbGluZS5zcGxpdCgnICcpLmZvckVhY2goKHdvcmQsIGopID0+IHtcbiAgICAgICAgICAgICAgICByZXMgKz0gKGogPT09IDAgPyAnJyA6ICcgJyk7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmtleXMuaW5kZXhPZih3b3JkWzBdKTtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcyArPSB3b3JkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzICs9IGA8c3BhbiBzdHlsZT1cIm1hcmdpbjogLS4xZW07cGFkZGluZzogMCAuMWVtO2JvcmRlci1yYWRpdXM6IDFlbTtjb2xvcjoke3RoaXMuY29sb3JzW2luZGV4XX07YmFja2dyb3VuZDoke3RoaXMuYmdzW2luZGV4XX07XCI+JHt3b3JkfTwvc3Bhbj5gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlcyArICdcXG5cXG4nO1xuICAgIH1cbiAgICBrZXlFdmVudCgpIHtcbiAgICAgICAgdGhpcy5kaXNwbGF5RWxlbWVudC5pbm5lckhUTUwgPSB0aGlzLm1hc2soKTtcbiAgICAgICAgdGhpcy5zY3JvbGxFdmVudCgpO1xuICAgIH1cbn1cbiIsImNsYXNzIFV4SGFzaCB7XG4gICAgcHJpdmF0ZSBpZDogc3RyaW5nO1xuICAgIHByaXZhdGUgcXVlcnlTZWxlY3Rvcjogc3RyaW5nO1xuICAgIHByaXZhdGUgd3JhcHBlckVsZW1lbnQ6IEhUTUxEaXZFbGVtZW50O1xuICAgIHByaXZhdGUgdGV4dGFyZWFFbGVtZW50OiBIVE1MVGV4dEFyZWFFbGVtZW50O1xuICAgIHByaXZhdGUgZGlzcGxheUVsZW1lbnQ6IEhUTUxEaXZFbGVtZW50O1xuICAgIHByaXZhdGUga2V5czogc3RyaW5nW107XG4gICAgcHJpdmF0ZSBjb2xvcnM6IHN0cmluZ1tdO1xuICAgIHByaXZhdGUgYmdzOiBzdHJpbmdbXTtcbiAgICBjb25zdHJ1Y3RvcihxdWVyeVNlbGVjdG9yOiBzdHJpbmcsIHRoZW1lczogVGhlbWVbXSkge1xuICAgICAgICB0aGlzLmlkID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpO1xuICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3IgPSBxdWVyeVNlbGVjdG9yO1xuICAgICAgICB0aGlzLmtleXMgPSB0aGVtZXMubWFwKCh0aGVtZTogVGhlbWUpID0+IHRoZW1lLmtleSk7XG4gICAgICAgIHRoaXMuY29sb3JzID0gdGhlbWVzLm1hcCgodGhlbWU6IFRoZW1lKSA9PiB0aGVtZS5jb2xvcik7XG4gICAgICAgIHRoaXMuYmdzID0gdGhlbWVzLm1hcCgodGhlbWU6IFRoZW1lKSA9PiB0aGVtZS5iZyk7XG4gICAgICAgIHRoaXMud3JhcHBlckVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMucXVlcnlTZWxlY3RvcikgYXMgSFRNTERpdkVsZW1lbnQ7XG4gICAgICAgIHRoaXMudGV4dGFyZWFFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKTtcbiAgICAgICAgdGhpcy5kaXNwbGF5RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLm1ha2VTdHlsZSgpO1xuICAgICAgICB0aGlzLndyYXBwZXJFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMudGV4dGFyZWFFbGVtZW50KTtcbiAgICAgICAgdGhpcy53cmFwcGVyRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmRpc3BsYXlFbGVtZW50KTtcbiAgICAgICAgdGhpcy5kaXNwbGF5RWxlbWVudC5zdHlsZS5yaWdodCA9IHRoaXMudGV4dGFyZWFFbGVtZW50LnNjcm9sbFdpZHRoIC0gdGhpcy50ZXh0YXJlYUVsZW1lbnQuY2xpZW50V2lkdGggKyAncHgnO1xuICAgICAgICB0aGlzLnRleHRhcmVhRWxlbWVudC5vbmtleXVwID0gdGhpcy5rZXlFdmVudC5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLnRleHRhcmVhRWxlbWVudC5vbnNjcm9sbCA9IHRoaXMuc2Nyb2xsRXZlbnQuYmluZCh0aGlzKTtcbiAgICB9XG5cbiAgICBtYWtlU3R5bGUoKSB7XG4gICAgICAgIGNvbnN0IGNvbW1vblN0eWxlID0gJ292ZXJmbG93OiBhdXRvO292ZXJmbG93LXg6IGhpZGRlbjtkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50O2hlaWdodDogMTAwJTttYXJnaW46IDA7cGFkZGluZzogMWVtO2JveC1zaXppbmc6IGJvcmRlci1ib3g7Ym9yZGVyOiAwO2xpbmUtaGVpZ2h0OiBpbmhlcml0O3dvcmQtc3BhY2luZzogaW5oZXJpdDtjb2xvcjogaW5oZXJpdDtmb250OiBpbmhlcml0O3Jlc2l6ZTogbm9uZTtvdXRsaW5lOiBub25lO3dvcmQtYnJlYWs6IGluaXRpYWw7d2hpdGUtc3BhY2U6IHByZS13cmFwOydcbiAgICAgICAgdGhpcy53cmFwcGVyRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdyZWxhdGl2ZSc7XG4gICAgICAgIHRoaXMud3JhcHBlckVsZW1lbnQuc3R5bGUuZm9udFNpemUgPSAnMTJweCc7XG4gICAgICAgIHRoaXMudGV4dGFyZWFFbGVtZW50LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBjb21tb25TdHlsZSArICd3aWR0aDogMTAwJTsnKTtcbiAgICAgICAgdGhpcy5kaXNwbGF5RWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgY29tbW9uU3R5bGUgKyAnei1pbmRleDoyO3Bvc2l0aW9uOiBhYnNvbHV0ZTt0b3A6IDA7cmlnaHQ6IDA7bGVmdDogMDtvdmVyZmxvdzogaGlkZGVuO2NvbG9yOiB0cmFuc3BhcmVudDtwb2ludGVyLWV2ZW50czogbm9uZTsnICk7XG4gICAgfVxuXG4gICAgc2Nyb2xsRXZlbnQoKSB7XG4gICAgICAgIHRoaXMuZGlzcGxheUVsZW1lbnQuc2Nyb2xsVG9wID0gdGhpcy50ZXh0YXJlYUVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgICAgICB0aGlzLnRleHRhcmVhRWxlbWVudC5zY3JvbGxUb3AgPSB0aGlzLmRpc3BsYXlFbGVtZW50LnNjcm9sbFRvcDtcbiAgICB9XG5cbiAgICBzdGF0aWMga2V5RXZlbnQocXVlcnlTZWxlY3Rvcjogc3RyaW5nLCB0aGVtZXM6IFRoZW1lW10pIHtcbiAgICAgICAgY29uc3Qgd3JhcHBlckVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHF1ZXJ5U2VsZWN0b3IpIGFzIEhUTUxEaXZFbGVtZW50O1xuICAgICAgICBjb25zdCB0ZXh0YXJlYUVsZW1lbnQgPSB3cmFwcGVyRWxlbWVudC5xdWVyeVNlbGVjdG9yKCd0ZXh0YXJlYScpIGFzIEhUTUxUZXh0QXJlYUVsZW1lbnQ7XG4gICAgICAgIGNvbnN0IGRpc3BsYXlFbGVtZW50ID0gd3JhcHBlckVsZW1lbnQucXVlcnlTZWxlY3RvcignZGl2JykgYXMgSFRNTERpdkVsZW1lbnQ7XG4gICAgICAgIGNvbnN0IGlkID0gd3JhcHBlckVsZW1lbnQuY2xhc3NOYW1lO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHdyYXBwZXJFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3RleHRhcmVhJykhLnZhbHVlO1xuICAgICAgICBjb25zdCBrZXlzID0gdGhlbWVzLm1hcCgodGhlbWU6IFRoZW1lKSA9PiB0aGVtZS5rZXkpO1xuICAgICAgICBjb25zdCBjb2xvcnMgPSB0aGVtZXMubWFwKCh0aGVtZTogVGhlbWUpID0+IHRoZW1lLmNvbG9yKTtcbiAgICAgICAgY29uc3QgYmdzID0gdGhlbWVzLm1hcCgodGhlbWU6IFRoZW1lKSA9PiB0aGVtZS5iZyk7XG4gICAgICAgIGxldCByZXMgPSAnJztcbiAgICAgICAgdmFsdWUuc3BsaXQoJ1xcbicpLmZvckVhY2goKGxpbmU6IHN0cmluZywgaTogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICByZXMgKz0gKGkgPT09IDAgPyAnJyA6ICdcXG4nKTtcbiAgICAgICAgICAgIGxpbmUuc3BsaXQoJyAnKS5mb3JFYWNoKCh3b3JkOiBzdHJpbmcsIGo6IG51bWJlcikgPT4ge1xuICAgICAgICAgICAgICAgIHJlcyArPSAoaiA9PT0gMCA/ICcnIDogJyAnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGtleXMuaW5kZXhPZih3b3JkWzBdKTtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcyArPSB3b3JkO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcyArPSBgPHNwYW4gc3R5bGU9XCJtYXJnaW46IC0uMWVtO3BhZGRpbmc6IDAgLjFlbTtib3JkZXItcmFkaXVzOiAxZW07Y29sb3I6JHtjb2xvcnNbaW5kZXhdfTtiYWNrZ3JvdW5kOiR7YmdzW2luZGV4XX07XCI+JHt3b3JkfTwvc3Bhbj5gXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBkaXNwbGF5RWxlbWVudC5zY3JvbGxUb3AgPSB0ZXh0YXJlYUVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgICAgICB0ZXh0YXJlYUVsZW1lbnQuc2Nyb2xsVG9wID0gZGlzcGxheUVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgICAgICBkaXNwbGF5RWxlbWVudC5pbm5lckhUTUwgPSByZXMgKyAnXFxuXFxuJztcbiAgICB9XG5cbiAgICBtYXNrKCkge1xuICAgICAgICBsZXQgcmVzID0gJyc7XG4gICAgICAgIHRoaXMudGV4dGFyZWFFbGVtZW50LnZhbHVlLnNwbGl0KCdcXG4nKS5mb3JFYWNoKChsaW5lOiBzdHJpbmcsIGk6IG51bWJlcikgPT4ge1xuICAgICAgICAgICAgcmVzICs9IChpID09PSAwID8gJycgOiAnXFxuJyk7XG4gICAgICAgICAgICBsaW5lLnNwbGl0KCcgJykuZm9yRWFjaCgod29yZDogc3RyaW5nLCBqOiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgICAgICByZXMgKz0gKGogPT09IDAgPyAnJyA6ICcgJyk7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmtleXMuaW5kZXhPZih3b3JkWzBdKTtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcyArPSB3b3JkO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcyArPSBgPHNwYW4gc3R5bGU9XCJtYXJnaW46IC0uMWVtO3BhZGRpbmc6IDAgLjFlbTtib3JkZXItcmFkaXVzOiAxZW07Y29sb3I6JHt0aGlzLmNvbG9yc1tpbmRleF19O2JhY2tncm91bmQ6JHt0aGlzLmJnc1tpbmRleF19O1wiPiR7d29yZH08L3NwYW4+YFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlcyArICdcXG5cXG4nO1xuICAgIH1cblxuICAgIGtleUV2ZW50KCkge1xuICAgICAgICB0aGlzLmRpc3BsYXlFbGVtZW50LmlubmVySFRNTCA9IHRoaXMubWFzaygpO1xuICAgICAgICB0aGlzLnNjcm9sbEV2ZW50KCk7XG4gICAgfVxufVxudHlwZSBUaGVtZSA9IHtcbiAgICBiZzpzdHJpbmcsXG4gICAgY29sb3I6c3RyaW5nLFxuICAgIGtleTpzdHJpbmdcbn0iXX0=
